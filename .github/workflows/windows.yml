name: windows
on:
  # push:
  #  branches: ["main"]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
      # - run: where perl
      #   shell: cmd
      # - run: which -a perl
      #   shell: bash

      - run: |
          pip install conan
          conan profile detect
        shell: bash
      - run: |
          conan install --requires ffmpeg/7.1.1 --build="ffmpeg/*" --build="zlib/*" -of 1 \
            -o 'ffmpeg/*:shared=True' -o 'zlib/*:shared=True' \
            -o "ffmpeg/*:avcodec=True" -o "ffmpeg/*:avdevice=False" -o "ffmpeg/*:avfilter=False" -o "ffmpeg/*:avformat=True" -o "ffmpeg/*:disable_all_bitstream_filters=True" -o "ffmpeg/*:disable_all_decoders=True" -o "ffmpeg/*:disable_all_demuxers=True" -o "ffmpeg/*:disable_all_devices=False" -o "ffmpeg/*:disable_all_encoders=True" -o "ffmpeg/*:disable_all_filters=True" -o "ffmpeg/*:disable_all_hardware_accelerators=True" -o "ffmpeg/*:disable_all_input_devices=False" -o "ffmpeg/*:disable_all_muxers=True" -o "ffmpeg/*:disable_all_output_devices=False" -o "ffmpeg/*:disable_all_parsers=True" -o "ffmpeg/*:disable_all_protocols=True" -o "ffmpeg/*:disable_bitstream_filters=None" -o "ffmpeg/*:disable_decoders=None" -o "ffmpeg/*:disable_demuxers=None" -o "ffmpeg/*:disable_encoders=None" -o "ffmpeg/*:disable_everything=False" -o "ffmpeg/*:disable_filters=None" -o "ffmpeg/*:disable_hardware_accelerators=None" -o "ffmpeg/*:disable_input_devices=None" -o "ffmpeg/*:disable_muxers=None" -o "ffmpeg/*:disable_output_devices=None" -o "ffmpeg/*:disable_parsers=None" -o "ffmpeg/*:disable_protocols=None" -o "ffmpeg/*:enable_bitstream_filters=None" -o "ffmpeg/*:enable_decoders=bink,binkaudio_dct,binkaudio_rdft,opus,smackaud,smacker,theora,vorbis,vp8,vp9" -o "ffmpeg/*:enable_demuxers=bink,binka,ogg,smacker,webm_dash_manifest" -o "ffmpeg/*:enable_encoders=None" -o "ffmpeg/*:enable_filters=None" -o "ffmpeg/*:enable_hardware_accelerators=None" -o "ffmpeg/*:enable_input_devices=None" -o "ffmpeg/*:enable_muxers=None" -o "ffmpeg/*:enable_output_devices=None" -o "ffmpeg/*:enable_parsers=opus,vorbis,vp8,vp9,webp" -o "ffmpeg/*:enable_protocols=file" -o "ffmpeg/*:postproc=False" -o "ffmpeg/*:swresample=True" -o "ffmpeg/*:swscale=True" -o "ffmpeg/*:with_asm=False" -o "ffmpeg/*:with_bzip2=True" -o "ffmpeg/*:with_fontconfig=False" -o "ffmpeg/*:with_freetype=False" -o "ffmpeg/*:with_fribidi=False" -o "ffmpeg/*:with_harfbuzz=False" -o "ffmpeg/*:with_libaom=False" -o "ffmpeg/*:with_libdav1d=False" -o "ffmpeg/*:with_libfdk_aac=False" -o "ffmpeg/*:with_libiconv=False" -o "ffmpeg/*:with_libmp3lame=False" -o "ffmpeg/*:with_libsvtav1=False" -o "ffmpeg/*:with_libvpx=False" -o "ffmpeg/*:with_libwebp=False" -o "ffmpeg/*:with_libx264=False" -o "ffmpeg/*:with_libx265=False" -o "ffmpeg/*:with_lzma=True" -o "ffmpeg/*:with_openh264=False" -o "ffmpeg/*:with_openjpeg=False" -o "ffmpeg/*:with_opus=True" -o "ffmpeg/*:with_programs=False" -o "ffmpeg/*:with_sdl=False" -o "ffmpeg/*:with_soxr=False" -o "ffmpeg/*:with_ssl=False" -o "ffmpeg/*:with_vorbis=False" -o "ffmpeg/*:with_zeromq=False" -o "ffmpeg/*:with_zlib=True" \
            -c "tools.build:defines=['_WIN32_WINNT=0x0601', 'WINVER=0x0601', 'NTDDI_VERSION=0x06010000']"
        shell: bash
        # if: ${{ !always() }}
